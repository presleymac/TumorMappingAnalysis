# TumourMappingAnalysis
Repository for all code pertaining to the paper Toward Predicting Nanoparticle Distribution in Heterogeneous Tumour Tissues
Pipeline involves 13 Steps. Steps 1,3-8 use MATLAB v2018b Steps 9-13 use Python v3.6.12


MATLAB code: 

 Step 1: .czi conversion to multipage tiff

 Step 2: Segment image with Ilastik* Separate program based in python (https://www.ilastik.org/)

 Step 3: Macrophage post processing

 Step 4: Label macrophages

 Step5: Vessel Processing
 
 Step6: Identify and measure vessel features

 	6A: Identify features and extract metadata
     6B: Run analysis script and save vessel data    
 Step7: Process Nanoparticles
 
 Step8: Identify Nanoparticle Regions



STEPS 2, 9 - onward use Python3.6.12

Python Processing assumes the following organizatinal structure for images:

General Data Structure - Data folder image strings are hard coded assuming the 
following data folder structure:

1: Top level folder (containing subfolders with all image data)

    2: Tumour folders sorted by nanoparticle size. 
        Nameing convertion: U87-GNP{np_size}nm
        3.Folders sorted by time points
            Nameing convertion {time in hours}h
            4. Image subfolders. Generated during .czi conversion
                Naming convention: {image_name}
                note: scripts assume image names start with either 'MSC' or 'UT'
                5. Processed image folders
                    -Generated by MATLAB scripts steps 1-8
                    which Relys on having run .czi conversion and having 
                    segmented ilastik images in a 'pre_processing_2022'
                6. Neighbourhood_Analysis_2023
                    



STEP9_vessel_processing_only_um_2023.py

Run this first on each time point folder (level 3)

STEP10_NP_region_processing_radius_um_2023.py 

    Note:  image names endings are hard coded in get_image_and_data_paths() to 
            correspond to the names as defined in the MATLAB scripts


STEP11_sphere_sampling_2023.py 

    Loops over folder by default assumes you select the time point folder. 
    Generates spherical samples of desired size and number.
    When run this script takes a user input for radius size but the script can be 
    easily modified to loop over multiple radii. 
   
   Note: this step is slow and computationally intensive

STEP12_index_of_dispersion_calc_um_2023.py

   Calculates index of dispersion, assumes minimum tissue threshold of 10% 
   Assumes you specifiy the top folder and that all data follows the folder structure
   outlined above

STEP13_logisdtic_regression_script.py.

   Loads the data table corresponding to the radius being tested. Data is split into 
   testing and training datasets, normalized, scaled and sampled using SMOTE_NC. Data
   is prepared for model training and the logistic regression model is trained. Finally
   the testing dataset is used to assess how well the logisitic regression model 
   preforms.


# License

Copytight 2023 MacMillan et al.

This software license is the 2-clause BSD license plus a third clause that prohibits redistribution and use for commercial purposes without further permission from the authors of this work (MacMillan et al).

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

Redistributions and use for commercial purposes are not permitted without the written permission of the authors of this work (MacMillan et al). For purposes of this license, commercial purposes are the incorporation of the software into anything for which you will charge fees or other compensation or use of the software to perform a commercial service for a third party.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
